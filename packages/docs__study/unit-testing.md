# 前端单元测试

近几年，前端发展越来越迅猛，各类框架层出不穷，前端实现的业务逻辑也越来越复杂，前端单元测试也越来越受重视，包括百度在内的一些大厂在面试中也会问到单元测试相关的题目。

## 单侧的定义

>在计算机编程中，单元测试（Unit Testing）又称为模块测试，是针对程序模块（软件设计的最小单位）来进行正确性检验的测试工作。

>程序单元是应用的最小可测试部件。在过程化编程中，一个单元就是单个程序、函数、过程等；对于面向对象编程，最小单元就是方法，包括基类（超类）、抽象类、或者派生类（子类）中的方法。

定义里面指出，单元测试针对的是程序的最小单元，因此我们应该针对最小单元来写单测。

## 单测完善程度的衡量

单测完善程度的衡量用覆盖率来衡量，关于测试覆盖率，我们大致了解下以下几个常见的计算维度：

- 行覆盖率：可执行语句执行的比例
- 函数覆盖率：函数被调用的比例
- 分支覆盖率：判断语句分支被执行的比例

来看下面这个例子：

![](https://pic3.zhimg.com/80/v2-19de62784f67a4c442bb3081497194ea_1440w.jpg)

对于测试用例 foo(4)，分支覆盖率只有50%，原因是 foo(4) 只测试了if 为 true 的情况，没有测试到 if 为 false 的情况。

如果想要分支覆盖率达到100%，还应该测试 foo(5)。

## 单测的价值与意义

- **能力建设**：一个具备开发经验的开发人员，基本上都会编写单元测试。即便不会，可以通过培训来快速达成。从学习曲线上看，单元测试很容易上手。
- **提升效率**：能够通过 mock 数据，及早发现问题，而越早发现Bug，造成的浪费就会越小。
- **追求卓越**：单元测试可以充当一个设计工具，它有助于开发人员去思考代码结构的设计，让代码更加有利于测试。
- **测试更全面**：能够覆盖 QA 测试覆盖不到的情况，比如各种 if 分支、异常处理。
- **更有信心**：升级公共 API 时，如果依赖这个 API 的所有代码单测都能通过，那我们对这次代码升级是更有信心的。

## 单侧的编写原则

> 单测的原则

![](https://pic3.zhimg.com/80/v2-9eb11cfc3908c4915d195106cbac8eb2_1440w.jpg)

> 单测需要测什么

![](https://pic3.zhimg.com/80/v2-1017705bf42c3667c4ceb4f4b2d5f56a_1440w.jpg)

> 写单侧的时机

写单测的时机主要有以下三种

### 具体实现代码之前

即测试驱动开发（TDD）：编写某个功能的代码之前先编写测试代码，然后编写使测试通过的功能代码，重复这个过程，通过测试来推动整个开发的进行。

::: info
UT 能够更好的实践我们的代码设计。对于某些复杂度较高的接口（甚至是一些私有方法），建议使用 TDD 进行开发。
:::

### 与具体实现代码同步进行

先写少量功能代码，紧接着写单元测试（重复这两个过程，直到完成功能代码开发）。

::: tip
每个单测比较简单易懂，可读性可维护性都比较好（重构时单测的改动不大）。
:::

### 编写完功能代码后

这种单元测试“粒度”会比较粗。对同样的功能代码，采取前两种方案的结果可能是用10个“小”的单测来覆盖，而这种方案写的单测，往往是用1个“大”的单测来覆盖。

::: warning
逻辑就比较复杂，因为它要测的东西很多，可读性可维护性可能会比较差。
:::

## 测试工具

- **Jest** 是目前最流行的框架之一，是Facebook团队构建和维护的JavaScript测试框架，基于 Jasmine，至今已经做了大量修改添加了很多特性。
- **Vitest** 的主要优势之一是它与 Vite 的统一配置、并且对 jest 友好。vitest会读取您的根目录`vite.config.ts`以匹配插件并设置为您的 `Vite` 应用程序。
